# Bazel Bootcamp

## Before you get started

Follow these [slides][1] both to learn about Bazel and to get more context on the exercises.

You should have installed:

- [Bazel](https://bazel.build/install) (optionally [Bazelisk](https://github.com/bazelbuild/bazelisk))
- Java JDK (e.g. `sudo apt install openjdk-11-jdk`). **Note:** Tested with JDK 11, and at least JDK 19 has issues under MacOS.
- `java -version` should work

## Exercise 1: Hello, Bazel!

Let's execute a Java binary.

1.  Edit: `java/src/main/java/bazel/bootcamp/BUILD`
1.  Add a `java_binary` target for the `HelloBazelBootcamp.java` file
    - [`java_binary` documentation](https://docs.bazel.build/versions/master/be/java.html#java_binary)
1.  Run the binary using `bazel run //java/src/main/java/bazel/bootcamp:HelloBazelBootcamp`

## Exercise 2: Go server

Let's compile and run the server code.

1.  The Go `BUILD` files can be fully generated by [Gazelle](https://github.com/bazelbuild/bazel-gazelle). Run gazelle with `bazel run //:gazelle`
1.  Run the go binary using `bazel run //go/cmd/server`
1.  Go to http://localhost:8081 to see results (there won't be any logs yet): `curl http://localhost:8081`

## Exercise 3: Java client

Now let's compile and run the client code. It uses GRPC so we'll need to build the proto files and link them as dependencies.

1.  Edit the `BUILD` file for `logger.proto`
    - [`java_proto_library` documentation](https://docs.bazel.build/versions/master/be/java.html#java_proto_library)
    - [`java_grpc_library` documentation](https://grpc.io/docs/reference/java/generated-code.html) (look towards the
      bottom of the page for Bazel related documentation)
1.  Edit the `BUILD` file for `JavaLoggingClientLibrary.java`
    - [`java_library` documentation](https://docs.bazel.build/versions/master/be/java.html#java_library)
1.  Edit the `BUILD` file for `JavaLoggingClient.java`
    - [`java_binary` documentation](https://docs.bazel.build/versions/master/be/java.html#java_binary)
1.  `bazel run` the Java binary you wrote
1.  `bazel run` the Go binary from Section 2
1.  Send messages from the client to the server and view them on http://localhost:8081

## Exercise 4: Java client unit tests

Let's make Bazel also run the java unit tests.

1.  Edit the `BUILD` file for `JavaLoggingClientLibraryTest.java`
    - [`java_test` documentation](https://docs.bazel.build/versions/master/be/java.html#java_test)
    <details> <summary>Hint</summary>Names matter for tests. The <code>java_test</code> for this file should be named <code>JavaLoggingClientLibraryTest</code></details>
1.  Edit the `BUILD` file for `JavaLoggingClientTest.java`
1.  Run the tests using `bazel test`

## Exercise 5: Integration test

There is an integration test that uses both the go server binary, and the java client binary. Let's run it through Bazel.

1.  Edit the `BUILD` file for `integrationtest.sh`
    - [`sh_test` documentation](https://docs.bazel.build/versions/master/be/shell.html#sh_test)
1.  Run the test using `bazel test` and make sure that it passes
1.  Now run the test using `bazel test <target> --runs_per_test=10`. It will fail, so you might need to find how to fix it.
    <details> <summary>Hint</summary>You may need to modify the <code>BUILD</code> file again to make this work</details>
    <details> <summary>Hint</summary>Maybe because of the nature of the test you can't run it concurrently, and needs to be run sequentially?</details>

## Exercise 6: Queries

The [slides][1] contain some examples you can try by yourself.

You can also use as reference the [Official query guide](https://bazel.build/query/guide).

[1]: https://docs.google.com/presentation/d/1-iUbooVCxDB8mduzspScM0ZLGqjdraSDvVe3HzTYvYU/edit?usp=sharing&resourcekey=0-0psdmHUwDN8r6s3WVxUYeg
